(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9418:function(e,t,i){Promise.resolve().then(i.bind(i,2890))},2890:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return C}});var s=i(7437),n=i(3287),a=i(2265);function l(e){if(!e||!isFinite(e)||e<0)return"0:00";let t=Math.floor(e%60).toString().padStart(2,"0");return"".concat(Math.floor(e/60),":").concat(t)}function r(e){let{peaks:t,duration:i=null,currentTime:n=0,onSeek:r,loop:o=null,height:h=96}=e,c=(0,a.useRef)(null);return(0,a.useEffect)(()=>{t&&c.current&&function(e,t){let i=c.current;if(!i)return;let s=window.devicePixelRatio||1,a=i.clientWidth;i.width=Math.floor(a*s),i.height=Math.floor(h*s);let l=i.getContext("2d");if(!l)return;l.scale(s,s),l.clearRect(0,0,a,h),l.fillStyle="rgba(255,255,255,0.02)",l.fillRect(0,0,a,h),l.fillStyle="rgba(168,85,247,0.85)";let r=h/2;for(let t=0;t<e.length;t++){let i=t/e.length*a,s=e[t]*(.9*h);l.fillRect(i,r-s/2,Math.max(1,a/e.length),s)}if(o&&t>0){let e=o.start/t*a,i=o.end/t*a;l.fillStyle="rgba(255, 0, 128, 0.12)",l.fillRect(e,0,Math.max(1,i-e),h),l.strokeStyle="rgba(255,0,128,0.5)",l.lineWidth=2,l.strokeRect(e,1,Math.max(1,i-e),h-2)}if(t>0){let e=n%t/t*a;l.fillStyle="#9b5cff",l.fillRect(e-1,0,2,h),l.fillStyle="rgba(155,92,255,0.08)",l.fillRect(e-8,0,16,h)}}(t,i||0)},[t,n,o,i]),(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("div",{className:"relative rounded-md overflow-hidden",children:(0,s.jsx)("canvas",{ref:c,onClick:function(e){if(!r||!c.current||!i)return;let t=c.current.getBoundingClientRect();r((e.clientX-t.left)/t.width*i)},className:"w-full block cursor-pointer",style:{height:h}})}),(0,s.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-400",children:[(0,s.jsxs)("div",{children:[" ",l(n)," "]}),(0,s.jsxs)("div",{children:[" ",i?"-".concat(l(Math.max(0,i-(n||0)))):"-:--"," "]})]})]})}function o(e){let{value:t=.5,onChange:i}=e;return(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:t,onChange:e=>null==i?void 0:i(parseFloat(e.target.value)),className:"w-24"})}function h(e){let{level:t=0}=e;return(0,s.jsx)("div",{className:"h-24 w-8 bg-black/20 rounded flex items-end p-1",children:(0,s.jsx)("div",{className:"w-full bg-gradient-to-t from-red-500 via-yellow-400 to-green-400 rounded",style:{height:"".concat(100*Math.max(0,Math.min(1,t)),"%")}})})}let c=(e,t,i)=>Math.max(t,Math.min(i,e));class u{ensureCtx(){if(!this.engine.audioCtx)throw Error("AudioContext not initialized");return this.engine.audioCtx}initNodes(){let e=this.engine.getOrCreateContext();this.gain=e.createGain(),this.dryGain=e.createGain(),this.wetGain=e.createGain(),this.lowEQ=e.createBiquadFilter(),this.lowEQ.type="lowshelf",this.midEQ=e.createBiquadFilter(),this.midEQ.type="peaking",this.highEQ=e.createBiquadFilter(),this.highEQ.type="highshelf",this.delay=e.createDelay(5),this.delay.delayTime.value=this.fx.delayTime,this.delayFeedbackGain=e.createGain(),this.delayFeedbackGain.gain.value=c(this.fx.delayFeedback,0,.6),this.fxLowpass=e.createBiquadFilter(),this.fxLowpass.type="lowpass",this.fxLowpass.frequency.value=this.fx.lowpassCutoff,this.convolver=e.createConvolver(),this.convolver.buffer=this.engine.createReverbImpulse(.5),this.lowEQ.connect(this.midEQ),this.midEQ.connect(this.highEQ),this.highEQ.connect(this.dryGain),this.delay.connect(this.delayFeedbackGain),this.delayFeedbackGain.connect(this.delay),this.delay.connect(this.fxLowpass),this.fxLowpass.connect(this.convolver),this.convolver.connect(this.wetGain),this.dryGain.connect(this.gain),this.wetGain.connect(this.gain),this.gain.connect(this.engine.masterGain),this.dryGain.gain.value=1-this.fx.wet,this.wetGain.gain.value=this.fx.wet,this.gain.gain.value=this.volumeVal}async loadBuffer(e){this.buffer=e,this.position=0,this.stopSourceIfAny();try{this.peaks=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,i=e.numberOfChannels>0?e.getChannelData(0):new Float32Array(0),s=Math.floor(i.length/t)||1,n=new Float32Array(t);for(let e=0;e<t;e++){let t=e*s,a=Math.min(t+s,i.length),l=0;for(let e=t;e<a;e++){let t=Math.abs(i[e]);t>l&&(l=t)}n[e]=l}return n}(e,2048),this.rms=function(e){let t=0,i=0;for(let s=0;s<e.numberOfChannels;s++){let n=e.getChannelData(s);for(let e=0;e<n.length;e++){let s=n[e];t+=s*s,i++}}return Math.sqrt(t/Math.max(1,i))}(e),this.duration=e.duration}catch(t){this.peaks=null,this.rms=null,this.duration=e.duration||null}}stopSourceIfAny(){if(this.restartTimer&&(clearTimeout(this.restartTimer),this.restartTimer=null),this.source){try{this.source.onended=null,this.source.stop()}catch(e){}this.source.disconnect(),this.source=null}this.isPlaying=!1}createSource(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=this.ensureCtx();if(!this.buffer)return;this.stopSourceIfAny();let t=e.createBufferSource();t.buffer=this.buffer,t.loop=this.loopEnabled,this.loopEnabled&&(t.loopStart=this.loopStart,t.loopEnd=this.loopEnd||this.loopStart+1),t.connect(this.lowEQ),this.source=t}restartWithFade(e,t){let i="number"==typeof t?t:this.engine.fadeMs,s=this.ensureCtx(),n=s.currentTime;if(!this.gain){this.stopSourceIfAny(),this.createSource(e),this.source&&(this.startTime=s.currentTime-e,this.source.start(0,e),this.isPlaying=!0);return}try{this.gain.gain.cancelScheduledValues(n);let e=this.gain.gain.value;this.gain.gain.setValueAtTime(e,n),this.gain.gain.linearRampToValueAtTime(0,n+i)}catch(e){}this.restartTimer&&clearTimeout(this.restartTimer),this.restartTimer=window.setTimeout(()=>{if(this.stopSourceIfAny(),this.createSource(e),!this.source)return;let t=this.ensureCtx().currentTime;try{this.gain.gain.setValueAtTime(0,t)}catch(e){}this.source.start(0,e),this.startTime=t-e,this.isPlaying=!0;try{this.gain.gain.linearRampToValueAtTime(this.volumeVal,t+i)}catch(e){this.gain.gain.setValueAtTime(this.volumeVal,t)}this.restartTimer=null},Math.max(1,Math.floor(1e3*i)))}play(){let e=this.ensureCtx();if(!this.buffer||this.isPlaying)return;let t=this.position%this.buffer.duration;if(this.createSource(t),this.source){this.startTime=e.currentTime-t;try{this.gain&&this.gain.gain.setValueAtTime(this.volumeVal,e.currentTime),this.source.start(0,t),this.isPlaying=!0}catch(e){console.warn("Source start error",e)}}}pause(){let e=this.ensureCtx();this.isPlaying&&(this.position=e.currentTime-this.startTime,this.position<0&&(this.position=0),this.stopSourceIfAny())}seek(e){if(this.ensureCtx(),!this.buffer)return;let t=c(e,0,this.buffer.duration||e);this.position=t,this.isPlaying&&this.restartWithFade(t)}jog(e){if(!this.buffer)return;let t=c(e,-5,5),i=c((this.isPlaying?this.engine.getCurrentTime(this.id):this.position)+t,0,this.buffer.duration);this.isPlaying?this.restartWithFade(i):this.seek(i)}setVolume(e){this.volumeVal=c(e,0,1),this.gain&&this.gain.gain.setValueAtTime(this.volumeVal,this.ensureCtx().currentTime)}setGainValue(e){this.gain?this.gain.gain.setValueAtTime(c(e,0,1),this.ensureCtx().currentTime):this.volumeVal=c(e,0,1)}setEQ(e){let{low:t,mid:i,high:s}=e,n=c(t,-12,12),a=c(i,-12,12),l=c(s,-12,12);this.eq={low:n,mid:a,high:l},this.lowEQ&&(this.lowEQ.gain.value=n),this.midEQ&&(this.midEQ.gain.value=a,this.midEQ.Q.value=1,this.midEQ.frequency.value=1e3),this.highEQ&&(this.highEQ.gain.value=l)}setFX(e){this.fx={...this.fx,...e},this.delay&&(this.delay.delayTime.value=c(this.fx.delayTime,0,5)),this.delayFeedbackGain&&(this.delayFeedbackGain.gain.value=c(this.fx.delayFeedback,0,.6)),this.fxLowpass&&(this.fxLowpass.frequency.value=c(this.fx.lowpassCutoff,40,2e4)),this.wetGain&&(this.wetGain.gain.value=c(this.fx.wet,0,1)),this.dryGain&&(this.dryGain.gain.value=1-c(this.fx.wet,0,1))}setLoop(e,t){if(this.loopEnabled=e,e){let e=this.engine.getCurrentTime(this.id);this.loopStart=e,this.loopEnd=e+(t||1),this.buffer&&this.loopEnd>this.buffer.duration&&(this.loopEnd=this.buffer.duration)}if(this.isPlaying){let e=this.engine.getCurrentTime(this.id);this.createSource(e),this.source&&(this.startTime=this.ensureCtx().currentTime-e,this.source.start(0,e))}}getPosition(){return this.engine.audioCtx&&this.isPlaying?this.engine.audioCtx.currentTime-this.startTime:this.position}constructor(e,t){this.buffer=null,this.peaks=null,this.rms=null,this.duration=null,this.gain=null,this.dryGain=null,this.wetGain=null,this.lowEQ=null,this.midEQ=null,this.highEQ=null,this.delay=null,this.delayFeedbackGain=null,this.fxLowpass=null,this.convolver=null,this.source=null,this.isPlaying=!1,this.position=0,this.startTime=0,this.restartTimer=null,this.loopEnabled=!1,this.loopStart=0,this.loopEnd=0,this.volumeVal=1,this.eq={low:0,mid:0,high:0},this.fx={delayTime:.25,delayFeedback:.2,lowpassCutoff:8e3,reverbWet:0,wet:.2},this.engine=e,this.id=t,this.initNodes()}}class d{getOrCreateContext(){return this.audioCtx||(this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioCtx.createGain(),this.masterGain.gain.value=1,this.masterAnalyser=this.audioCtx.createAnalyser(),this.masterAnalyser.fftSize=2048,this.masterAnalyser.smoothingTimeConstant=.3,this.masterGain.connect(this.masterAnalyser),this.masterAnalyser.connect(this.audioCtx.destination),this.decks={A:new u(this,"A"),B:new u(this,"B")}),this.audioCtx}async resumeIfNeeded(){let e=this.getOrCreateContext();"suspended"===e.state&&await e.resume()}async decodeFile(e){let t=this.getOrCreateContext(),i=await e.arrayBuffer();return await t.decodeAudioData(i)}async loadDeckFromFile(e,t){let i=await this.decodeFile(t);this.decks||this.getOrCreateContext(),this.decks[e].loadBuffer(i)}playDeck(e){this.getOrCreateContext(),this.decks[e].play()}pauseDeck(e){this.getOrCreateContext(),this.decks[e].pause()}seekDeck(e,t){this.getOrCreateContext(),this.decks[e].seek(t)}setDeckVolume(e,t){this.getOrCreateContext(),this.decks[e].setVolume(t)}setDeckEQ(e,t){this.getOrCreateContext(),this.decks[e].setEQ(t)}setDeckFX(e,t){this.getOrCreateContext(),this.decks[e].setFX(t)}setDeckLoop(e,t,i){this.getOrCreateContext(),this.decks[e].setLoop(t,i)}jogDeck(e,t){this.getOrCreateContext(),this.decks[e].jog(t)}setCrossfade(e){var t,i,s,n;if(!this.decks)return;let a=c(e,0,1);null===(t=(i=this.decks.A).setGainValue)||void 0===t||t.call(i,Math.cos(a*Math.PI*.5)),null===(s=(n=this.decks.B).setGainValue)||void 0===s||s.call(n,Math.cos((1-a)*Math.PI*.5))}getCurrentTime(e){return this.decks?this.decks[e].getPosition():0}getMasterLevel(){if(!this.masterAnalyser||!this.audioCtx)return 0;let e=new Float32Array(this.masterAnalyser.fftSize);try{this.masterAnalyser.getFloatTimeDomainData(e)}catch(e){return 0}let t=0;for(let i=0;i<e.length;i++)t+=e[i]*e[i];return Math.min(1,3*Math.sqrt(t/e.length))}getDeckInfo(e){var t,i,s,n;if(!this.decks)return{peaks:null,rms:null,duration:null};let a=this.decks[e];return{peaks:null!==(t=a.peaks)&&void 0!==t?t:null,rms:null!==(i=a.rms)&&void 0!==i?i:null,duration:null!==(s=a.duration)&&void 0!==s?s:null,isPlaying:null!==(n=a.isPlaying)&&void 0!==n&&n}}createReverbImpulse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=this.getOrCreateContext(),s=i.sampleRate,n=s*e,a=i.createBuffer(2,n,s);for(let e=0;e<2;e++){let i=a.getChannelData(e);for(let e=0;e<n;e++)i[e]=(2*Math.random()-1)*Math.pow(1-e/n,t)}return a}constructor(){this.audioCtx=null,this.masterGain=null,this.decks=null,this.masterAnalyser=null,this.fadeMs=.008}}let m=new d;function f(e){let{id:t,className:i=""}=e,l=(0,a.useRef)(null),[c,u]=(0,a.useState)(null),[d,f]=(0,a.useState)(null),[g,x]=(0,a.useState)(0),[p,y]=(0,a.useState)(!1),[v,b]=(0,a.useState)(null),[w,k]=(0,a.useState)(.5),[C,j]=(0,a.useState)(.5),[N,E]=(0,a.useState)(.5),[T,A]=(0,a.useState)(!1),[D,S]=(0,a.useState)(.2),F=[1,2,4,8],[M,P]=(0,a.useState)(!1),[I,G]=(0,a.useState)(2);async function R(e){var i;let s=null===(i=e.target.files)||void 0===i?void 0:i[0];if(!s)return;await m.loadDeckFromFile(t,s);let n=m.getDeckInfo(t);n.peaks&&u(n.peaks),n.duration&&f(n.duration),void 0!==n.rms&&null!==n.rms&&b(n.rms)}return(0,a.useEffect)(()=>{let e=0;return e=requestAnimationFrame(function i(){let s=m.getDeckInfo(t);s.duration&&f(s.duration),s.peaks&&u(s.peaks),void 0!==s.rms&&null!==s.rms&&b(s.rms),y(!!s.isPlaying),x(m.getCurrentTime(t)),e=requestAnimationFrame(i)}),()=>cancelAnimationFrame(e)},[t]),(0,a.useEffect)(()=>{m.setDeckEQ(t,{low:(w-.5)*24,mid:(C-.5)*24,high:(N-.5)*24})},[w,C,N,t]),(0,a.useEffect)(()=>{m.setDeckFX(t,{wet:T?D:0})},[T,D,t]),(0,a.useEffect)(()=>{m.setDeckLoop(t,M,F[I])},[M,I,t]),(0,s.jsxs)(n.E.div,{initial:{y:8,opacity:0},animate:{y:0,opacity:1},transition:{duration:.45},className:"p-4 rounded-xl border border-white/5 glass-strong neon-outline ".concat(i),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("h2",{className:"text-lg font-medium",children:["Deck ",t]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:function(){var e;null===(e=l.current)||void 0===e||e.click()},className:"px-2 py-1 bg-white/6 rounded",children:"Load"}),(0,s.jsx)("input",{ref:l,className:"hidden",type:"file",accept:"audio/*",onChange:R})]})]}),(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)(r,{peaks:c,duration:d,currentTime:g,onSeek:function(e){m.seekDeck(t,e)},loop:M&&d?{start:0,end:F[I]}:null})}),(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,s.jsx)("button",{onClick:function(){p?m.pauseDeck(t):m.playDeck(t)},className:"px-3 py-2 bg-gradient-to-r from-purple-600 to-pink-500 rounded text-white",children:p?"Pause":"Play"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Low"}),(0,s.jsx)(o,{value:w,onChange:e=>k(e)})]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Mid"}),(0,s.jsx)(o,{value:C,onChange:e=>j(e)})]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"High"}),(0,s.jsx)(o,{value:N,onChange:e=>E(e)})]})]}),(0,s.jsx)("div",{className:"w-20",children:(0,s.jsx)(h,{level:v?Math.min(1,5*v):0})})]}),(0,s.jsxs)("div",{className:"mt-3 flex items-center gap-3",children:[(0,s.jsxs)("button",{onClick:()=>A(e=>!e),className:"px-3 py-1 rounded ".concat(T?"bg-pink-500 text-white":"bg-white/6"),children:["FX ",T?"On":"Off"]}),(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:D,onChange:e=>S(parseFloat(e.target.value)),className:"w-36"}),(0,s.jsxs)("button",{onClick:function(){P(e=>!e)},className:"px-3 py-1 rounded ".concat(M?"bg-pink-500 text-white":"bg-white/6"),children:["Loop ",M?"(".concat(F[I],"s)"):"Off"]}),(0,s.jsx)("button",{onClick:function(){G(e=>(e+1)%F.length)},className:"px-2 py-1 bg-white/6 rounded",children:"Cycle Length"})]})]})}function g(e){let{value:t=.5,onChange:i}=e,[l,r]=(0,a.useState)(0),o=(0,a.useRef)(null),c=(0,a.useRef)(null);return(0,a.useEffect)(()=>(o.current=requestAnimationFrame(function e(){r(m.getMasterLevel()),o.current=requestAnimationFrame(e)}),()=>{o.current&&cancelAnimationFrame(o.current)}),[]),(0,a.useEffect)(()=>{let e=c.current;if(e)return e.addEventListener("keydown",s),()=>e.removeEventListener("keydown",s);function s(e){let s=Number(null!=t?t:.5);"ArrowLeft"===e.key||"a"===e.key||"A"===e.key?(s=Math.max(0,s-.02),null==i||i(parseFloat(s.toFixed(3))),e.preventDefault()):"ArrowRight"===e.key||"d"===e.key||"D"===e.key?(s=Math.min(1,s+.02),null==i||i(parseFloat(s.toFixed(3))),e.preventDefault()):"Home"===e.key?(null==i||i(0),e.preventDefault()):"End"===e.key?(null==i||i(1),e.preventDefault()):"0"===e.key&&(null==i||i(.5),e.preventDefault())}},[t,i]),(0,s.jsxs)(n.E.div,{ref:c,tabIndex:0,"aria-label":"Crossfader control. Use left/right arrows to adjust.",className:"p-4 rounded-xl glass border border-white/5 w-full focus:outline-none",initial:{y:6,opacity:0},animate:{y:0,opacity:1},transition:{duration:.35},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("div",{className:"text-sm text-gray-300",children:"Crossfader"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Master"}),(0,s.jsx)("div",{className:"w-12",children:(0,s.jsx)(h,{level:l})})]})]}),(0,s.jsx)(n.E.input,{role:"slider","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":Number(t),type:"range",min:0,max:1,step:.01,value:t,onChange:e=>null==i?void 0:i(parseFloat(e.target.value)),className:"w-full",whileTap:{scale:.995}}),(0,s.jsx)("div",{className:"mt-2 text-xs text-gray-400",children:"Keyboard: ← / → to nudge, Home/End to jump"})]})}class x{async start(e,t,s){var n,a,l,r;if(this.running)return;this.videoEl=e,this.onResultsCb=t;let{Hands:o}=await i.e(370).then(i.t.bind(i,1370,23));this.hands=new o({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/hands/".concat(e)}),this.hands.setOptions({maxNumHands:null!==(n=null==s?void 0:s.maxNumHands)&&void 0!==n?n:2,modelComplexity:null!==(a=null==s?void 0:s.modelComplexity)&&void 0!==a?a:1,minDetectionConfidence:null!==(l=null==s?void 0:s.minDetectionConfidence)&&void 0!==l?l:.7,minTrackingConfidence:null!==(r=null==s?void 0:s.minTrackingConfidence)&&void 0!==r?r:.5}),this.hands.onResults(e=>{let t=(e.multiHandLandmarks||[]).map(e=>e.map(e=>({x:e.x,y:e.y,z:e.z})));try{var i;null===(i=this.onResultsCb)||void 0===i||i.call(this,t,e.multiHandedness)}catch(e){console.error("HandTracker onResults callback error",e)}}),this.running=!0,s&&s.fpsLimit&&(this.fpsLimit=s.fpsLimit);let h=async()=>{if(!this.running)return;let e=performance.now(),t=1e3/this.fpsLimit;if(this.videoEl&&this.videoEl.readyState>=2&&e-this.lastProcessTime>=t){try{await this.hands.send({image:this.videoEl})}catch(e){}this.lastProcessTime=e}this.rafId=requestAnimationFrame(h)};h()}stop(){this.running=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);try{var e,t;null===(t=this.hands)||void 0===t||null===(e=t.close)||void 0===e||e.call(t)}catch(e){}}isRunning(){return this.running}constructor(){this.running=!1,this.hands=null,this.rafId=null,this.fpsLimit=30,this.lastProcessTime=0}}function p(e,t,i){return Math.max(t,Math.min(i,e))}let y="gesturedj:calibration";class v{startCalibration(){this.calibration={sampleCount:0,ranges:{thumb:null,index:null,middle:null,ring:null},timestamp:Date.now()}}absorbSample(e){if(!this.calibration)return;let t={thumb:4,index:8,middle:12,ring:16};["thumb","index","middle","ring"].forEach(i=>{let s=e[t[i]];if(!s)return;let n=s.y,a=this.calibration.ranges[i];a?(a.min=Math.min(a.min,n),a.max=Math.max(a.max,n)):this.calibration.ranges[i]={min:n,max:n}}),this.calibration.sampleCount+=1}finishCalibration(){if(!this.calibration)return null;this.calibration.timestamp=Date.now();let e=this.calibration;try{localStorage.setItem(y,JSON.stringify(e))}catch(e){}return this.calibration=null,e}load(){try{let e=localStorage.getItem(y);e&&(this.calibration=JSON.parse(e))}catch(e){this.calibration=null}}getCalibration(){return this.calibration}getSaved(){try{let e=localStorage.getItem(y);if(!e)return null;return JSON.parse(e)}catch(e){return null}}mapFingerY(e,t){var i;let s=this.getSaved(),n="".concat(e),a=.5;if(s&&s.ranges&&s.ranges[e]){let i=s.ranges[e];a=p(1-(i.max===i.min?.5:(t-i.min)/(i.max-i.min)),0,1)}else a=p(1-t,0,1);let l=null!==(i=this.lastSmoothed[n])&&void 0!==i?i:a,r=l+this.smoothingAlpha*(a-l);return this.lastSmoothed[n]=r,r}checkHold(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300;if(!t)return this.holdTimers[e]=null,!1;if(!this.holdTimers[e])return this.holdTimers[e]=Date.now(),!1;{let t=this.holdTimers[e];return Date.now()-t>=i}}resetHolds(){this.holdTimers={}}decideDeckForHand(e,t){var i;let s=null!==(i=this.lastAssigned[e])&&void 0!==i?i:null;return t<=this.leftThresh?(this.lastAssigned[e]="A","A"):t>=this.rightThresh?(this.lastAssigned[e]="B","B"):s||(t<.5?"A":"B")}mapHandsToControls(e,t){let i={A:{assigned:!1,volume:.5,eq:{low:0,mid:0,high:0},scrubDelta:0},B:{assigned:!1,volume:.5,eq:{low:0,mid:0,high:0},scrubDelta:0}};return e.forEach((e,t)=>{if(!e||0===e.length)return;let s=e.reduce((e,t)=>e+t.x,0)/e.length,n=this.decideDeckForHand(t,s),a=e[8],l=e[12],r=e[16],o=e[4],h=a?this.mapFingerY("index",a.y):.5,c=o?(2*this.mapFingerY("thumb",o.y)-1)*12:0,u=l?(2*this.mapFingerY("middle",l.y)-1)*12:0,d=r?(2*this.mapFingerY("ring",r.y)-1)*12:0;i[n].assigned=!0,i[n].volume=h,i[n].eq={low:u,mid:d,high:c},i[n].scrubDelta=0}),i}constructor(){this.calibration=null,this.smoothingAlpha=.15,this.lastSmoothed={},this.holdTimers={},this.lastAssigned={},this.leftThresh=.45,this.rightThresh=.55,this.load()}}let b=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[17,18],[18,19],[19,20],[0,17]];function w(){var e,t;let i=(0,a.useRef)(null),l=(0,a.useRef)(null),r=(0,a.useRef)(null),o=(0,a.useRef)(null),[h,c]=(0,a.useState)(!1),u=(0,a.useRef)({}),d=(0,a.useRef)({}),[f,g]=(0,a.useState)(0),[p,y]=(0,a.useState)(null);async function w(){try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});i.current&&(i.current.srcObject=e,await i.current.play().catch(()=>{}));let t=new x;r.current=t,o.current=new v,t.start(i.current,(e,t)=>{if(function(e){let t=l.current,s=i.current;if(!t||!s)return;let n=t.getContext("2d");if(!n)return;let a=t.width=s.videoWidth||320,r=t.height=s.videoHeight||240;n.clearRect(0,0,a,r),n.lineWidth=2,e.forEach((e,t)=>{n.strokeStyle=0===t?"rgba(99,102,241,0.9)":"rgba(236,72,153,0.9)",b.forEach(t=>{let[i,s]=t,l=e[i],o=e[s];l&&o&&(n.beginPath(),n.moveTo(l.x*a,l.y*r),n.lineTo(o.x*a,o.y*r),n.stroke())}),e.forEach((e,t)=>{n.fillStyle="white",n.beginPath(),n.arc(e.x*a,e.y*r,3,0,2*Math.PI),n.fill()})})}(e),!o.current)return;e&&e[0]&&o.current.getCalibration()&&o.current.absorbSample(e[0]);let s=null;try{var n;s=o.current.mapHandsToControls(e,t),y(s),null===(n=l.current)||void 0===n||n.setAttribute("data-controls",JSON.stringify(s))}catch(e){s=null}e.forEach((e,t)=>{if(!e||0===e.length)return;let i=e.reduce((e,t)=>e+t.x,0)/e.length<.5?"A":"B",s=e[0],n=[4,8,12,16,20].map(t=>e[t]).filter(Boolean),a=n.reduce((e,t)=>e+Math.hypot(t.x-s.x,t.y-s.y),0)/n.length<.08,l="fist_".concat(t,"_").concat(i);o.current.checkHold(l,a,300)&&!d.current[l]&&(m.getDeckInfo(i).isPlaying?m.pauseDeck(i):m.playDeck(i),d.current[l]=!0),a||(d.current[l]=!1);let r=e[4],h=e[8],c=!1;r&&h&&(c=.04>Math.hypot(r.x-h.x,r.y-h.y));let f="pinch_".concat(t,"_").concat(i);o.current.checkHold(f,c,300)&&!d.current[f]&&(m.setDeckLoop(i,!0,2),d.current[f]=!0),c||(d.current[f]=!1);let g=e[9];if(s&&g){var x;let e=g.x-s.x,n=g.y-s.y,a=Math.atan2(n,e),l=null!==(x=u.current[t])&&void 0!==x?x:a,r=a-l;for(;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;u.current[t]=a;let o=2.5*r;Math.abs(o)>1e-4&&m.jogDeck(i,o)}}),s&&["A","B"].forEach(e=>{let t=s[e];t&&t.assigned&&(m.setDeckVolume(e,t.volume),m.setDeckEQ(e,{low:t.eq.low,mid:t.eq.mid,high:t.eq.high}))})}),c(!0)}catch(e){console.error("Camera error",e)}}function k(){c(!1);try{var e;null===(e=r.current)||void 0===e||e.stop()}catch(e){}r.current=null;let t=i.current;t&&t.srcObject&&(t.srcObject.getTracks().forEach(e=>e.stop()),t.srcObject=null);let s=l.current;if(s){let e=s.getContext("2d");e&&e.clearRect(0,0,s.width,s.height)}}async function C(){o.current||(o.current=new v),o.current.startCalibration();let e=Date.now(),t=0,i=setInterval(()=>{let s=Date.now()-e,n=Math.min(1,s/3e3);if(g(n),s>=3e3){clearInterval(i);let e=o.current.finishCalibration();g(0),console.log("Calibration finished",e)}else Math.floor(100*n)!==t&&(t=Math.floor(100*n))},100)}return(0,a.useEffect)(()=>()=>{k()},[]),(0,s.jsxs)(n.E.div,{initial:{scale:.98,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.35},className:"w-48 h-40 bg-black/30 rounded overflow-hidden border border-white/5 relative neon-shadow",children:[(0,s.jsx)("video",{ref:i,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,s.jsx)("canvas",{ref:l,className:"absolute inset-0 w-full h-full pointer-events-none"}),(0,s.jsx)("div",{className:"p-2 absolute bottom-2 left-2 flex gap-2",children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:k,className:"px-2 py-1 bg-red-600/80 rounded text-sm text-white",children:"Stop Camera"}),(0,s.jsx)("button",{onClick:C,className:"px-2 py-1 bg-gradient-to-r from-green-500 to-teal-400 rounded text-sm text-white",children:"Calibrate"})]}):(0,s.jsx)("button",{onClick:w,className:"px-2 py-1 bg-white/6 rounded text-sm",children:"Start Camera"})}),f>0&&(0,s.jsxs)("div",{className:"absolute top-2 left-2 bg-white/6 px-2 py-1 rounded text-xs",children:["Calibrating: ",(100*f).toFixed(0),"%"]}),p&&(0,s.jsxs)("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs p-2 rounded w-44",children:[(0,s.jsx)("div",{className:"font-medium",children:"Mapped"}),(0,s.jsxs)("div",{className:"mt-1",children:["A: ",(null===(e=p.A)||void 0===e?void 0:e.assigned)?"vol ".concat(p.A.volume.toFixed(2)):"—"]}),(0,s.jsxs)("div",{children:["B: ",(null===(t=p.B)||void 0===t?void 0:t.assigned)?"vol ".concat(p.B.volume.toFixed(2)):"—"]})]})]})}function k(){return(0,s.jsxs)("div",{className:"p-4 rounded-xl glass border border-white/5",children:[(0,s.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Calibration"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 bg-gradient-to-r from-purple-600 to-pink-500 rounded text-white text-sm",children:"Calibrate"}),(0,s.jsx)("button",{className:"px-3 py-1 bg-white/6 rounded text-sm",children:"Reset"})]})]})}function C(){let[e,t]=(0,a.useState)(!1),[i,l]=(0,a.useState)(.5);return(0,a.useEffect)(()=>{function e(e){let t=document.activeElement&&document.activeElement.tagName||"";if("INPUT"!==t&&"TEXTAREA"!==t){if("Space"===e.code){let t=m.getDeckInfo("A").isPlaying,i=m.getDeckInfo("B").isPlaying;t||i?(m.pauseDeck("A"),m.pauseDeck("B")):(m.playDeck("A"),m.playDeck("B")),e.preventDefault()}else if("1"===e.key)m.getDeckInfo("A").isPlaying?m.pauseDeck("A"):m.playDeck("A");else if("2"===e.key)m.getDeckInfo("B").isPlaying?m.pauseDeck("B"):m.playDeck("B");else if("ArrowLeft"===e.key){let e=Math.max(0,i-.05);l(e),m.setCrossfade(e)}else if("ArrowRight"===e.key){let e=Math.min(1,i+.05);l(e),m.setCrossfade(e)}}}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[i]),(0,s.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-semibold",children:"GestureDJ"}),(0,s.jsxs)("div",{className:"space-x-3 flex items-center",children:[(0,s.jsx)(n.E.button,{whileTap:{scale:.96},onClick:function(){t(!0),m.getOrCreateContext()},className:"bg-gradient-to-r from-purple-600 to-pink-500 px-4 py-2 rounded-lg text-white shadow-lg",children:"Start DJ Mode"}),(0,s.jsx)("div",{className:"ml-4",children:(0,s.jsx)(k,{})})]})]}),(0,s.jsxs)("section",{className:"grid grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"col-span-1",children:(0,s.jsx)(f,{id:"A"})}),(0,s.jsxs)("div",{className:"col-span-1 flex flex-col items-center gap-4",children:[(0,s.jsx)(g,{value:i,onChange:function(e){l(e),m.setCrossfade(e)}}),(0,s.jsx)(w,{})]}),(0,s.jsx)("div",{className:"col-span-1",children:(0,s.jsx)(f,{id:"B"})})]}),(0,s.jsx)("footer",{className:"mt-8 text-sm text-gray-400",children:"Camera and audio permissions will be requested when entering DJ Mode."})]})}}},function(e){e.O(0,[287,971,117,744],function(){return e(e.s=9418)}),_N_E=e.O()}]);