(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9418:function(e,t,i){Promise.resolve().then(i.bind(i,2890))},2890:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return C}});var s=i(7437),a=i(3287),n=i(2265);function r(e){if(!e||!isFinite(e)||e<0)return"0:00";let t=Math.floor(e%60).toString().padStart(2,"0");return"".concat(Math.floor(e/60),":").concat(t)}function l(e){let{peaks:t,duration:i=null,currentTime:a=0,onSeek:l,loop:o=null,height:c=96,playing:h=!1}=e,d=(0,n.useRef)(null);return(0,n.useEffect)(()=>{t&&d.current&&function(e,t){let i=d.current;if(!i)return;let s=window.devicePixelRatio||1,n=i.clientWidth;i.width=Math.floor(n*s),i.height=Math.floor(c*s);let r=i.getContext("2d");if(!r)return;r.scale(s,s),r.clearRect(0,0,n,c),r.fillStyle="rgba(255,255,255,0.03)",r.fillRect(0,0,n,c);let l=r.createLinearGradient(0,0,n,0);l.addColorStop(0,"#b45bff"),l.addColorStop(.5,"#ff4fbf"),l.addColorStop(1,"#45c9ff"),r.fillStyle=l,r.shadowColor=h?"rgba(110,80,255,0.35)":"transparent",r.shadowBlur=h?16:0;let u=c/2,m=Math.max(1,n/e.length);for(let t=0;t<e.length;t++){let i=t/e.length*n,s=e[t]*(.9*c);r.fillRect(i,u-s/2,m,s)}if(r.shadowBlur=0,o&&t>0){let e=o.start/t*n,i=o.end/t*n;r.fillStyle="rgba(255, 79, 191, 0.12)",r.fillRect(e,0,Math.max(1,i-e),c),r.strokeStyle="rgba(255,79,191,0.4)",r.lineWidth=2,r.strokeRect(e,1,Math.max(1,i-e),c-2)}if(t>0){let e=a%t/t*n;r.fillStyle="#9b5cff",r.fillRect(e-1,0,2,c),r.fillStyle="rgba(155,92,255,0.12)",r.fillRect(e-8,0,16,c)}}(t,i||0)},[t,a,o,i,h]),(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("div",{className:"relative rounded-lg overflow-hidden wave-glow ".concat(h?"shadow-[0_0_0_1px_rgba(180,91,255,0.18)]":""),children:(0,s.jsx)("canvas",{ref:d,onClick:function(e){if(!l||!d.current||!i)return;let t=d.current.getBoundingClientRect();l((e.clientX-t.left)/t.width*i)},className:"w-full block cursor-pointer",style:{height:c}})}),(0,s.jsxs)("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-400",children:[(0,s.jsx)("div",{children:r(a)}),(0,s.jsx)("div",{children:i?"-".concat(r(Math.max(0,i-(a||0)))):"-:--"})]})]})}function o(e){let{value:t=.5,onChange:i,tone:a="A"}=e,n=270*t-135;return(0,s.jsxs)("div",{className:"relative h-14 w-14 flex items-center justify-center select-none",children:[(0,s.jsx)("div",{className:"absolute inset-0 rounded-full",style:{background:"conic-gradient(".concat("A"===a?"#b45bff":"#4fd1ff"," ").concat(270*t,"deg, ").concat("rgba(255,255,255,0.08)"," ").concat(270*t,"deg 360deg)"),boxShadow:"0 6px 16px rgba(0,0,0,0.35)"}}),(0,s.jsx)("div",{className:"h-11 w-11 rounded-full bg-[#0f1527] border border-white/10 relative flex items-center justify-center",children:(0,s.jsx)("div",{className:"absolute w-[2px] h-3 rounded-full",style:{background:"#fff",transform:"rotate(".concat(n,"deg) translateY(-5px)"),transformOrigin:"center 10px"}})}),(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:t,onChange:e=>null==i?void 0:i(parseFloat(e.target.value)),className:"absolute inset-0 opacity-0 cursor-pointer","aria-label":"EQ knob"})]})}function c(e){let{level:t=0}=e;return(0,s.jsx)("div",{className:"h-24 w-8 bg-black/20 rounded flex items-end p-1",children:(0,s.jsx)("div",{className:"w-full bg-gradient-to-t from-red-500 via-yellow-400 to-green-400 rounded",style:{height:"".concat(100*Math.max(0,Math.min(1,t)),"%")}})})}let h=(e,t,i)=>Math.max(t,Math.min(i,e));class d{ensureCtx(){if(!this.engine.audioCtx)throw Error("AudioContext not initialized");return this.engine.audioCtx}initNodes(){let e=this.engine.getOrCreateContext();this.gain=e.createGain(),this.dryGain=e.createGain(),this.wetGain=e.createGain(),this.lowEQ=e.createBiquadFilter(),this.lowEQ.type="lowshelf",this.midEQ=e.createBiquadFilter(),this.midEQ.type="peaking",this.highEQ=e.createBiquadFilter(),this.highEQ.type="highshelf",this.delay=e.createDelay(5),this.delay.delayTime.value=this.fx.delayTime,this.delayFeedbackGain=e.createGain(),this.delayFeedbackGain.gain.value=h(this.fx.delayFeedback,0,.6),this.fxLowpass=e.createBiquadFilter(),this.fxLowpass.type="lowpass",this.fxLowpass.frequency.value=this.fx.lowpassCutoff,this.convolver=e.createConvolver(),this.convolver.buffer=this.engine.createReverbImpulse(.5),this.lowEQ.connect(this.midEQ),this.midEQ.connect(this.highEQ),this.highEQ.connect(this.dryGain),this.delay.connect(this.delayFeedbackGain),this.delayFeedbackGain.connect(this.delay),this.delay.connect(this.fxLowpass),this.fxLowpass.connect(this.convolver),this.convolver.connect(this.wetGain),this.dryGain.connect(this.gain),this.wetGain.connect(this.gain),this.gain.connect(this.engine.masterGain),this.dryGain.gain.value=1-this.fx.wet,this.wetGain.gain.value=this.fx.wet,this.gain.gain.value=this.volumeVal}async loadBuffer(e){this.buffer=e,this.position=0,this.stopSourceIfAny();try{this.peaks=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,i=e.numberOfChannels>0?e.getChannelData(0):new Float32Array(0),s=Math.floor(i.length/t)||1,a=new Float32Array(t);for(let e=0;e<t;e++){let t=e*s,n=Math.min(t+s,i.length),r=0;for(let e=t;e<n;e++){let t=Math.abs(i[e]);t>r&&(r=t)}a[e]=r}return a}(e,2048),this.rms=function(e){let t=0,i=0;for(let s=0;s<e.numberOfChannels;s++){let a=e.getChannelData(s);for(let e=0;e<a.length;e++){let s=a[e];t+=s*s,i++}}return Math.sqrt(t/Math.max(1,i))}(e),this.duration=e.duration}catch(t){this.peaks=null,this.rms=null,this.duration=e.duration||null}}stopSourceIfAny(){if(this.restartTimer&&(clearTimeout(this.restartTimer),this.restartTimer=null),this.source){try{this.source.onended=null,this.source.stop()}catch(e){}this.source.disconnect(),this.source=null}this.isPlaying=!1}createSource(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=this.ensureCtx();if(!this.buffer)return;this.stopSourceIfAny();let t=e.createBufferSource();t.buffer=this.buffer,t.loop=this.loopEnabled,this.loopEnabled&&(t.loopStart=this.loopStart,t.loopEnd=this.loopEnd||this.loopStart+1),t.connect(this.lowEQ),this.source=t}restartWithFade(e,t){let i="number"==typeof t?t:this.engine.fadeMs,s=this.ensureCtx(),a=s.currentTime;if(!this.gain){this.stopSourceIfAny(),this.createSource(e),this.source&&(this.startTime=s.currentTime-e,this.source.start(0,e),this.isPlaying=!0);return}try{this.gain.gain.cancelScheduledValues(a);let e=this.gain.gain.value;this.gain.gain.setValueAtTime(e,a),this.gain.gain.linearRampToValueAtTime(0,a+i)}catch(e){}this.restartTimer&&clearTimeout(this.restartTimer),this.restartTimer=window.setTimeout(()=>{if(this.stopSourceIfAny(),this.createSource(e),!this.source)return;let t=this.ensureCtx().currentTime;try{this.gain.gain.setValueAtTime(0,t)}catch(e){}this.source.start(0,e),this.startTime=t-e,this.isPlaying=!0;try{this.gain.gain.linearRampToValueAtTime(this.volumeVal,t+i)}catch(e){this.gain.gain.setValueAtTime(this.volumeVal,t)}this.restartTimer=null},Math.max(1,Math.floor(1e3*i)))}play(){let e=this.ensureCtx();if(!this.buffer||this.isPlaying)return;let t=this.position%this.buffer.duration;if(this.createSource(t),this.source){this.startTime=e.currentTime-t;try{this.gain&&this.gain.gain.setValueAtTime(this.volumeVal,e.currentTime),this.source.start(0,t),this.isPlaying=!0}catch(e){console.warn("Source start error",e)}}}pause(){let e=this.ensureCtx();this.isPlaying&&(this.position=e.currentTime-this.startTime,this.position<0&&(this.position=0),this.stopSourceIfAny())}seek(e){if(this.ensureCtx(),!this.buffer)return;let t=h(e,0,this.buffer.duration||e);this.position=t,this.isPlaying&&this.restartWithFade(t)}jog(e){if(!this.buffer)return;let t=h(e,-5,5),i=h((this.isPlaying?this.engine.getCurrentTime(this.id):this.position)+t,0,this.buffer.duration);this.isPlaying?this.restartWithFade(i):this.seek(i)}setVolume(e){this.volumeVal=h(e,0,1),this.gain&&this.gain.gain.setValueAtTime(this.volumeVal,this.ensureCtx().currentTime)}setGainValue(e){this.gain?this.gain.gain.setValueAtTime(h(e,0,1),this.ensureCtx().currentTime):this.volumeVal=h(e,0,1)}setEQ(e){let{low:t,mid:i,high:s}=e,a=h(t,-12,12),n=h(i,-12,12),r=h(s,-12,12);this.eq={low:a,mid:n,high:r},this.lowEQ&&(this.lowEQ.gain.value=a),this.midEQ&&(this.midEQ.gain.value=n,this.midEQ.Q.value=1,this.midEQ.frequency.value=1e3),this.highEQ&&(this.highEQ.gain.value=r)}setFX(e){this.fx={...this.fx,...e},this.delay&&(this.delay.delayTime.value=h(this.fx.delayTime,0,5)),this.delayFeedbackGain&&(this.delayFeedbackGain.gain.value=h(this.fx.delayFeedback,0,.6)),this.fxLowpass&&(this.fxLowpass.frequency.value=h(this.fx.lowpassCutoff,40,2e4)),this.wetGain&&(this.wetGain.gain.value=h(this.fx.wet,0,1)),this.dryGain&&(this.dryGain.gain.value=1-h(this.fx.wet,0,1))}setLoop(e,t){if(this.loopEnabled=e,e){let e=this.engine.getCurrentTime(this.id);this.loopStart=e,this.loopEnd=e+(t||1),this.buffer&&this.loopEnd>this.buffer.duration&&(this.loopEnd=this.buffer.duration)}if(this.isPlaying){let e=this.engine.getCurrentTime(this.id);this.createSource(e),this.source&&(this.startTime=this.ensureCtx().currentTime-e,this.source.start(0,e))}}getPosition(){return this.engine.audioCtx&&this.isPlaying?this.engine.audioCtx.currentTime-this.startTime:this.position}constructor(e,t){this.buffer=null,this.peaks=null,this.rms=null,this.duration=null,this.gain=null,this.dryGain=null,this.wetGain=null,this.lowEQ=null,this.midEQ=null,this.highEQ=null,this.delay=null,this.delayFeedbackGain=null,this.fxLowpass=null,this.convolver=null,this.source=null,this.isPlaying=!1,this.position=0,this.startTime=0,this.restartTimer=null,this.loopEnabled=!1,this.loopStart=0,this.loopEnd=0,this.volumeVal=1,this.eq={low:0,mid:0,high:0},this.fx={delayTime:.25,delayFeedback:.2,lowpassCutoff:8e3,reverbWet:0,wet:.2},this.engine=e,this.id=t,this.initNodes()}}class u{getOrCreateContext(){return this.audioCtx||(this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioCtx.createGain(),this.masterGain.gain.value=1,this.masterAnalyser=this.audioCtx.createAnalyser(),this.masterAnalyser.fftSize=2048,this.masterAnalyser.smoothingTimeConstant=.3,this.masterGain.connect(this.masterAnalyser),this.masterAnalyser.connect(this.audioCtx.destination),this.decks={A:new d(this,"A"),B:new d(this,"B")}),this.audioCtx}async resumeIfNeeded(){let e=this.getOrCreateContext();"suspended"===e.state&&await e.resume()}async decodeFile(e){let t=this.getOrCreateContext(),i=await e.arrayBuffer();return await t.decodeAudioData(i)}async loadDeckFromFile(e,t){let i=await this.decodeFile(t);this.decks||this.getOrCreateContext(),this.decks[e].loadBuffer(i)}playDeck(e){this.getOrCreateContext(),this.decks[e].play()}pauseDeck(e){this.getOrCreateContext(),this.decks[e].pause()}seekDeck(e,t){this.getOrCreateContext(),this.decks[e].seek(t)}setDeckVolume(e,t){this.getOrCreateContext(),this.decks[e].setVolume(t)}setDeckEQ(e,t){this.getOrCreateContext(),this.decks[e].setEQ(t)}setDeckFX(e,t){this.getOrCreateContext(),this.decks[e].setFX(t)}setDeckLoop(e,t,i){this.getOrCreateContext(),this.decks[e].setLoop(t,i)}jogDeck(e,t){this.getOrCreateContext(),this.decks[e].jog(t)}setCrossfade(e){var t,i,s,a;if(!this.decks)return;let n=h(e,0,1);null===(t=(i=this.decks.A).setGainValue)||void 0===t||t.call(i,Math.cos(n*Math.PI*.5)),null===(s=(a=this.decks.B).setGainValue)||void 0===s||s.call(a,Math.cos((1-n)*Math.PI*.5))}getCurrentTime(e){return this.decks?this.decks[e].getPosition():0}getMasterLevel(){if(!this.masterAnalyser||!this.audioCtx)return 0;let e=new Float32Array(this.masterAnalyser.fftSize);try{this.masterAnalyser.getFloatTimeDomainData(e)}catch(e){return 0}let t=0;for(let i=0;i<e.length;i++)t+=e[i]*e[i];return Math.min(1,3*Math.sqrt(t/e.length))}getDeckInfo(e){var t,i,s,a;if(!this.decks)return{peaks:null,rms:null,duration:null};let n=this.decks[e];return{peaks:null!==(t=n.peaks)&&void 0!==t?t:null,rms:null!==(i=n.rms)&&void 0!==i?i:null,duration:null!==(s=n.duration)&&void 0!==s?s:null,isPlaying:null!==(a=n.isPlaying)&&void 0!==a&&a}}createReverbImpulse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=this.getOrCreateContext(),s=i.sampleRate,a=s*e,n=i.createBuffer(2,a,s);for(let e=0;e<2;e++){let i=n.getChannelData(e);for(let e=0;e<a;e++)i[e]=(2*Math.random()-1)*Math.pow(1-e/a,t)}return n}constructor(){this.audioCtx=null,this.masterGain=null,this.decks=null,this.masterAnalyser=null,this.fadeMs=.008}}let m=new u;function f(e){let{id:t,className:i=""}=e,r=(0,n.useRef)(null),[h,d]=(0,n.useState)(null),[u,f]=(0,n.useState)(null),[x,g]=(0,n.useState)(0),[p,y]=(0,n.useState)(!1),[v,b]=(0,n.useState)(null),[w,k]=(0,n.useState)(.82),[C,j]=(0,n.useState)(.5),[N,E]=(0,n.useState)(.5),[T,S]=(0,n.useState)(.5),[A,D]=(0,n.useState)(!1),[F,M]=(0,n.useState)(.2),P=[1,2,4,8],[R,I]=(0,n.useState)(!1),[G,B]=(0,n.useState)(2);async function L(e){var i;let s=null===(i=e.target.files)||void 0===i?void 0:i[0];if(!s)return;await m.loadDeckFromFile(t,s);let a=m.getDeckInfo(t);a.peaks&&d(a.peaks),a.duration&&f(a.duration),void 0!==a.rms&&null!==a.rms&&b(a.rms)}(0,n.useEffect)(()=>{let e=0;return e=requestAnimationFrame(function i(){let s=m.getDeckInfo(t);s.duration&&f(s.duration),s.peaks&&d(s.peaks),void 0!==s.rms&&null!==s.rms&&b(s.rms),y(!!s.isPlaying),g(m.getCurrentTime(t)),e=requestAnimationFrame(i)}),()=>cancelAnimationFrame(e)},[t]),(0,n.useEffect)(()=>{m.setDeckEQ(t,{low:(C-.5)*24,mid:(N-.5)*24,high:(T-.5)*24})},[C,N,T,t]),(0,n.useEffect)(()=>{m.setDeckVolume(t,w)},[w,t]),(0,n.useEffect)(()=>{m.setDeckFX(t,{wet:A?F:0})},[A,F,t]),(0,n.useEffect)(()=>{m.setDeckLoop(t,R,P[G])},[R,G,t]);let O="A"===t?"from-purple-500 via-pink-500 to-fuchsia-500":"from-cyan-400 via-blue-500 to-indigo-500",Q="A"===t?"text-purple-200":"text-cyan-200",V="A"===t?"border-purple-500/30":"border-cyan-400/30";return(0,s.jsxs)(a.E.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{duration:.4,type:"spring",stiffness:120,damping:18},className:"card-surface neon-outline p-4 rounded-2xl ".concat(i),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-xs uppercase tracking-[0.18em] text-gray-400 ".concat(Q),children:["Deck ",t]}),(0,s.jsx)("div",{className:"text-sm text-gray-300",children:"Upload a track to start"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:function(){var e;null===(e=r.current)||void 0===e||e.click()},className:"px-3 py-1.5 rounded-lg bg-gradient-to-r ".concat(O," text-white text-sm shadow-lg"),children:"Load"}),(0,s.jsx)("input",{ref:r,className:"hidden",type:"file",accept:"audio/*",onChange:L})]})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(l,{peaks:h,duration:u,currentTime:x,onSeek:function(e){m.seekDeck(t,e)},loop:R&&u?{start:0,end:P[G]}:null,height:140,playing:p})}),(0,s.jsxs)("div",{className:"grid grid-cols-[80px,1fr,96px] gap-4 items-center",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)(a.E.button,{whileTap:{scale:.95},onClick:function(){p?m.pauseDeck(t):m.playDeck(t)},className:"w-full px-3 py-2 rounded-lg text-sm font-semibold text-white shadow-lg bg-gradient-to-r ".concat(O),children:p?"Pause":"Play"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[(0,s.jsx)("span",{children:"Loop"}),(0,s.jsx)("button",{onClick:function(){I(e=>!e)},className:"px-2 py-1 rounded-md border ".concat(R?V+" text-white bg-white/10":"border-white/10 text-gray-300"),children:R?"".concat(P[G],"s"):"Off"}),(0,s.jsx)("button",{onClick:function(){B(e=>(e+1)%P.length)},className:"px-2 py-1 rounded-md border border-white/10 text-gray-300",children:"Cycle"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"Vol"}),(0,s.jsx)("div",{className:"h-28 w-10 flex items-end",children:(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:w,onChange:e=>k(parseFloat(e.target.value)),className:"w-full h-28 appearance-none bg-transparent rotate-[-90deg] origin-bottom",style:{accentColor:"A"===t?"#b45bff":"#4fd1ff"}})}),(0,s.jsxs)("span",{className:"text-[11px] text-gray-400",children:[Math.round(100*w),"%"]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"Low"}),(0,s.jsx)(o,{tone:t,value:C,onChange:e=>j(e)}),(0,s.jsxs)("span",{className:"text-[11px] text-gray-500",children:[((C-.5)*24).toFixed(1)," dB"]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"Mid"}),(0,s.jsx)(o,{tone:t,value:N,onChange:e=>E(e)}),(0,s.jsxs)("span",{className:"text-[11px] text-gray-500",children:[((N-.5)*24).toFixed(1)," dB"]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"High"}),(0,s.jsx)(o,{tone:t,value:T,onChange:e=>S(e)}),(0,s.jsxs)("span",{className:"text-[11px] text-gray-500",children:[((T-.5)*24).toFixed(1)," dB"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-300",children:[(0,s.jsxs)("button",{onClick:()=>D(e=>!e),className:"px-3 py-1.5 rounded-md border ".concat(A?V+" text-white bg-white/10":"border-white/10 text-gray-200"),children:["FX ",A?"On":"Off"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 w-48",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400 w-10",children:"Wet"}),(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:F,onChange:e=>M(parseFloat(e.target.value)),className:"w-full",style:{accentColor:"A"===t?"#b45bff":"#4fd1ff"}}),(0,s.jsxs)("div",{className:"w-10 text-right text-[11px] text-gray-400",children:[Math.round(100*F),"%"]})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-between gap-2 h-full",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Level"}),(0,s.jsx)("div",{className:"w-12",children:(0,s.jsx)(c,{level:v?Math.min(1,5*v):0})}),(0,s.jsx)("div",{className:"text-[11px] text-gray-500",children:u?function(e){if(!e||!isFinite(e)||e<0)return"0:00";let t=Math.floor(e%60).toString().padStart(2,"0");return"".concat(Math.floor(e/60),":").concat(t)}(u-x):"-:--"})]})]})]})}function x(e){let{value:t=.5,onChange:i}=e,[r,l]=(0,n.useState)(0),o=(0,n.useRef)(null),h=(0,n.useRef)(null);return(0,n.useEffect)(()=>(o.current=requestAnimationFrame(function e(){l(m.getMasterLevel()),o.current=requestAnimationFrame(e)}),()=>{o.current&&cancelAnimationFrame(o.current)}),[]),(0,n.useEffect)(()=>{let e=h.current;if(e)return e.addEventListener("keydown",s),()=>e.removeEventListener("keydown",s);function s(e){let s=Number(null!=t?t:.5);"ArrowLeft"===e.key||"a"===e.key||"A"===e.key?(s=Math.max(0,s-.02),null==i||i(parseFloat(s.toFixed(3))),e.preventDefault()):"ArrowRight"===e.key||"d"===e.key||"D"===e.key?(s=Math.min(1,s+.02),null==i||i(parseFloat(s.toFixed(3))),e.preventDefault()):"Home"===e.key?(null==i||i(0),e.preventDefault()):"End"===e.key?(null==i||i(1),e.preventDefault()):"0"===e.key&&(null==i||i(.5),e.preventDefault())}},[t,i]),(0,s.jsxs)(a.E.div,{ref:h,tabIndex:0,"aria-label":"Crossfader control. Use left/right arrows to adjust.",className:"p-4 rounded-2xl card-surface neon-outline w-full focus:outline-none",initial:{y:6,opacity:0},animate:{y:0,opacity:1},transition:{duration:.35,type:"spring",stiffness:140,damping:16},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("div",{className:"text-sm text-gray-300",children:"Crossfader"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Master"}),(0,s.jsx)("div",{className:"w-12",children:(0,s.jsx)(c,{level:r})})]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(a.E.input,{role:"slider","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":Number(t),type:"range",min:0,max:1,step:.01,value:t,onChange:e=>null==i?void 0:i(parseFloat(e.target.value)),className:"w-full h-2 appearance-none bg-white/10 rounded-full",style:{accentColor:"#b45bff"},whileTap:{scale:.995}}),(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-r from-purple-500/10 via-transparent to-cyan-400/10 rounded-full"})]}),(0,s.jsx)("div",{className:"mt-2 text-xs text-gray-400",children:"Keyboard: ← / → to nudge, Home/End to jump"})]})}class g{async start(e,t,s){var a,n,r,l;if(this.running)return;this.videoEl=e,this.onResultsCb=t;let{Hands:o}=await i.e(370).then(i.t.bind(i,1370,23));this.hands=new o({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/hands/".concat(e)}),this.hands.setOptions({maxNumHands:null!==(a=null==s?void 0:s.maxNumHands)&&void 0!==a?a:2,modelComplexity:null!==(n=null==s?void 0:s.modelComplexity)&&void 0!==n?n:1,minDetectionConfidence:null!==(r=null==s?void 0:s.minDetectionConfidence)&&void 0!==r?r:.7,minTrackingConfidence:null!==(l=null==s?void 0:s.minTrackingConfidence)&&void 0!==l?l:.5}),this.hands.onResults(e=>{let t=(e.multiHandLandmarks||[]).map(e=>e.map(e=>({x:e.x,y:e.y,z:e.z})));try{var i;null===(i=this.onResultsCb)||void 0===i||i.call(this,t,e.multiHandedness)}catch(e){console.error("HandTracker onResults callback error",e)}}),this.running=!0,s&&s.fpsLimit&&(this.fpsLimit=s.fpsLimit);let c=async()=>{if(!this.running)return;let e=performance.now(),t=1e3/this.fpsLimit;if(this.videoEl&&this.videoEl.readyState>=2&&e-this.lastProcessTime>=t){try{await this.hands.send({image:this.videoEl})}catch(e){}this.lastProcessTime=e}this.rafId=requestAnimationFrame(c)};c()}stop(){this.running=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null);try{var e,t;null===(t=this.hands)||void 0===t||null===(e=t.close)||void 0===e||e.call(t)}catch(e){}}isRunning(){return this.running}constructor(){this.running=!1,this.hands=null,this.rafId=null,this.fpsLimit=30,this.lastProcessTime=0}}function p(e,t,i){return Math.max(t,Math.min(i,e))}let y="gesturedj:calibration";class v{startCalibration(){this.calibration={sampleCount:0,ranges:{thumb:null,index:null,middle:null,ring:null},timestamp:Date.now()}}absorbSample(e){if(!this.calibration)return;let t={thumb:4,index:8,middle:12,ring:16};["thumb","index","middle","ring"].forEach(i=>{let s=e[t[i]];if(!s)return;let a=s.y,n=this.calibration.ranges[i];n?(n.min=Math.min(n.min,a),n.max=Math.max(n.max,a)):this.calibration.ranges[i]={min:a,max:a}}),this.calibration.sampleCount+=1}finishCalibration(){if(!this.calibration)return null;this.calibration.timestamp=Date.now();let e=this.calibration;try{localStorage.setItem(y,JSON.stringify(e))}catch(e){}return this.calibration=null,e}load(){try{let e=localStorage.getItem(y);e&&(this.calibration=JSON.parse(e))}catch(e){this.calibration=null}}getCalibration(){return this.calibration}getSaved(){try{let e=localStorage.getItem(y);if(!e)return null;return JSON.parse(e)}catch(e){return null}}mapFingerY(e,t){var i;let s=this.getSaved(),a="".concat(e),n=.5;if(s&&s.ranges&&s.ranges[e]){let i=s.ranges[e];n=p(1-(i.max===i.min?.5:(t-i.min)/(i.max-i.min)),0,1)}else n=p(1-t,0,1);let r=null!==(i=this.lastSmoothed[a])&&void 0!==i?i:n,l=r+this.smoothingAlpha*(n-r);return this.lastSmoothed[a]=l,l}checkHold(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300;if(!t)return this.holdTimers[e]=null,!1;if(!this.holdTimers[e])return this.holdTimers[e]=Date.now(),!1;{let t=this.holdTimers[e];return Date.now()-t>=i}}resetHolds(){this.holdTimers={}}decideDeckForHand(e,t){var i;let s=null!==(i=this.lastAssigned[e])&&void 0!==i?i:null;return t<=this.leftThresh?(this.lastAssigned[e]="A","A"):t>=this.rightThresh?(this.lastAssigned[e]="B","B"):s||(t<.5?"A":"B")}ensureCalibration(){if(this.getSaved())return;let e={sampleCount:1,ranges:{thumb:{min:.3,max:.8},index:{min:.3,max:.8},middle:{min:.3,max:.8},ring:{min:.3,max:.8}},timestamp:Date.now()};try{localStorage.setItem(y,JSON.stringify(e))}catch(e){}}mapHandsToControls(e,t){let i={A:{assigned:!1,volume:.5,eq:{low:0,mid:0,high:0},scrubDelta:0},B:{assigned:!1,volume:.5,eq:{low:0,mid:0,high:0},scrubDelta:0}};return e.forEach((e,t)=>{if(!e||0===e.length)return;let s=e.reduce((e,t)=>e+t.x,0)/e.length,a=this.decideDeckForHand(t,s),n=e[8],r=e[12],l=e[16],o=e[4],c=n?this.mapFingerY("index",n.y):.5,h=o?(2*this.mapFingerY("thumb",o.y)-1)*12:0,d=r?(2*this.mapFingerY("middle",r.y)-1)*12:0,u=l?(2*this.mapFingerY("ring",l.y)-1)*12:0;i[a].assigned=!0,i[a].volume=c,i[a].eq={low:d,mid:u,high:h},i[a].scrubDelta=0}),i}constructor(){this.calibration=null,this.smoothingAlpha=.15,this.lastSmoothed={},this.holdTimers={},this.lastAssigned={},this.leftThresh=.45,this.rightThresh=.55,this.load()}}let b=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[17,18],[18,19],[19,20],[0,17]];function w(){var e,t;let i=(0,n.useRef)(null),r=(0,n.useRef)(null),l=(0,n.useRef)(null),o=(0,n.useRef)(null),[c,h]=(0,n.useState)(!1),d=(0,n.useRef)({}),u=(0,n.useRef)({}),[f,x]=(0,n.useState)(0),[p,y]=(0,n.useState)(null),[w,k]=(0,n.useState)("Ready"),C=(0,n.useRef)(null);async function j(){try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});i.current&&(i.current.srcObject=e,await i.current.play().catch(()=>{}));let t=new g;l.current=t,o.current=new v,o.current.ensureCalibration(),t.start(i.current,(e,t)=>{if(function(e){let t=r.current,s=i.current;if(!t||!s)return;let a=t.getContext("2d");if(!a)return;let n=s.videoWidth||640,l=s.videoHeight||480;t.width=n,t.height=l,a.clearRect(0,0,n,l),a.lineWidth=2.5,e.forEach((e,t)=>{a.strokeStyle=0===t?"rgba(180,91,255,0.95)":"rgba(79,209,255,0.95)",a.shadowColor=0===t?"rgba(180,91,255,0.5)":"rgba(79,209,255,0.5)",a.shadowBlur=10,b.forEach(t=>{let[i,s]=t,r=e[i],o=e[s];r&&o&&(a.beginPath(),a.moveTo(r.x*n,r.y*l),a.lineTo(o.x*n,o.y*l),a.stroke())}),a.shadowBlur=0,e.forEach((e,t)=>{a.fillStyle="#e9eef7",a.beginPath(),a.arc(e.x*n,e.y*l,4,0,2*Math.PI),a.fill(),a.strokeStyle="rgba(255,255,255,0.3)",a.lineWidth=1,a.beginPath(),a.arc(e.x*n,e.y*l,6,0,2*Math.PI),a.stroke()})})}(e),!o.current)return;e&&e[0]&&o.current.getCalibration()&&o.current.absorbSample(e[0]);let s=null;try{var a;s=o.current.mapHandsToControls(e,t),y(s),null===(a=r.current)||void 0===a||a.setAttribute("data-controls",JSON.stringify(s))}catch(e){s=null}e.forEach((e,t)=>{if(!e||0===e.length)return;let i=e.reduce((e,t)=>e+t.x,0)/e.length<.5?"A":"B",s=e[0],a=[4,8,12,16,20].map(t=>e[t]).filter(Boolean),n=a.reduce((e,t)=>e+Math.hypot(t.x-s.x,t.y-s.y),0)/a.length<.15,r="fist_".concat(t,"_").concat(i);o.current.checkHold(r,n,300)&&!u.current[r]&&(m.getDeckInfo(i).isPlaying?m.pauseDeck(i):m.playDeck(i),k("✋ Play / Pause — Deck ".concat(i)),C.current&&clearTimeout(C.current),C.current=window.setTimeout(()=>k("Ready"),1500),u.current[r]=!0),n||(u.current[r]=!1);let l=e[4],c=e[8],h=!1;l&&c&&(h=.065>Math.hypot(l.x-c.x,l.y-c.y));let f="pinch_".concat(t,"_").concat(i);o.current.checkHold(f,h,300)&&!u.current[f]&&(m.setDeckLoop(i,!0,2),k("✌ Loop Toggle — Deck ".concat(i)),C.current&&clearTimeout(C.current),C.current=window.setTimeout(()=>k("Ready"),1500),u.current[f]=!0),h||(u.current[f]=!1);let x=e[9];if(s&&x){var g;let e=x.x-s.x,a=x.y-s.y,n=Math.atan2(a,e),r=null!==(g=d.current[t])&&void 0!==g?g:n,l=n-r;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;d.current[t]=n;let o=2.5*l;Math.abs(o)>1e-4&&(m.jogDeck(i,o),k("\uD83C\uDF9A Jog — Deck ".concat(i)),C.current&&clearTimeout(C.current),C.current=window.setTimeout(()=>k("Ready"),800))}}),s&&["A","B"].forEach(e=>{let t=s[e];t&&t.assigned&&(m.setDeckVolume(e,t.volume),m.setDeckEQ(e,{low:t.eq.low,mid:t.eq.mid,high:t.eq.high}),k("Deck ".concat(e," EQ / Volume")))})}),h(!0)}catch(e){console.error("Camera error",e)}}function N(){h(!1);try{var e;null===(e=l.current)||void 0===e||e.stop()}catch(e){}l.current=null;let t=i.current;t&&t.srcObject&&(t.srcObject.getTracks().forEach(e=>e.stop()),t.srcObject=null);let s=r.current;if(s){let e=s.getContext("2d");e&&e.clearRect(0,0,s.width,s.height)}}async function E(){o.current||(o.current=new v),o.current.startCalibration();let e=Date.now(),t=0,i=setInterval(()=>{let s=Date.now()-e,a=Math.min(1,s/3e3);if(x(a),s>=3e3){clearInterval(i);let e=o.current.finishCalibration();x(0),console.log("Calibration finished",e)}else Math.floor(100*a)!==t&&(t=Math.floor(100*a))},100)}return(0,n.useEffect)(()=>()=>{N()},[]),(0,s.jsxs)(a.E.div,{initial:{y:12,opacity:0},animate:{y:0,opacity:1},transition:{duration:.35,type:"spring",stiffness:140,damping:18},className:"relative w-full max-w-2xl h-[320px] sm:h-[360px] md:h-[380px] rounded-2xl overflow-hidden border border-white/8 glass-strong neon-shadow",children:[(0,s.jsx)("video",{ref:i,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,s.jsx)("canvas",{ref:r,className:"absolute inset-0 w-full h-full pointer-events-none",style:{display:"block"}}),(0,s.jsxs)("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-black/55 backdrop-blur-md px-3 py-2 rounded-lg flex items-center gap-2 text-xs text-white border border-white/10 shadow-lg",children:[(0,s.jsx)("span",{className:"text-base",children:"✋"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-[11px] uppercase tracking-[0.18em] text-gray-300",children:"Gesture Status"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:w})]})]}),(0,s.jsx)("div",{className:"p-2 absolute bottom-2 left-2 flex gap-2",children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.E.button,{whileTap:{scale:.94},onClick:N,className:"px-3 py-2 bg-red-600/80 rounded-lg text-sm text-white shadow-lg",children:"Stop"}),(0,s.jsx)(a.E.button,{whileTap:{scale:.94},onClick:E,className:"px-3 py-2 bg-gradient-to-r from-green-500 to-teal-400 rounded-lg text-sm text-white shadow-lg",children:"Calibrate"})]}):(0,s.jsx)(a.E.button,{whileTap:{scale:.94},onClick:j,className:"px-3 py-2 bg-gradient-to-r from-purple-500 via-pink-500 to-fuchsia-500 rounded-lg text-sm text-white shadow-lg",children:"Start Camera"})}),f>0&&(0,s.jsxs)(a.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute top-16 left-2 bg-black/60 backdrop-blur-md px-3 py-2 rounded-lg text-xs text-white border border-white/10 shadow-lg",children:[(0,s.jsxs)("div",{className:"font-medium mb-1",children:["Calibrating: ",(100*f).toFixed(0),"%"]}),(0,s.jsx)("div",{className:"w-40 h-1 bg-white/10 rounded-full overflow-hidden",children:(0,s.jsx)(a.E.div,{initial:{width:0},animate:{width:"".concat(100*f,"%")},className:"h-full bg-gradient-to-r from-green-500 to-teal-400"})})]}),p&&(0,s.jsxs)(a.E.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},className:"absolute top-3 right-3 bg-black/55 backdrop-blur-md text-white text-[11px] p-3 rounded-lg border border-white/10 shadow-lg space-y-1",children:[(0,s.jsx)("div",{className:"font-semibold text-xs",children:"Active Controls"}),(0,s.jsxs)("div",{className:"text-gray-300",children:["Deck A: ",(null===(e=p.A)||void 0===e?void 0:e.assigned)?"".concat((100*p.A.volume).toFixed(0),"%"):"—"]}),(0,s.jsxs)("div",{className:"text-gray-300",children:["Deck B: ",(null===(t=p.B)||void 0===t?void 0:t.assigned)?"".concat((100*p.B.volume).toFixed(0),"%"):"—"]})]})]})}function k(){return(0,s.jsxs)("div",{className:"p-4 rounded-xl glass border border-white/5",children:[(0,s.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Calibration"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 bg-gradient-to-r from-purple-600 to-pink-500 rounded text-white text-sm",children:"Calibrate"}),(0,s.jsx)("button",{className:"px-3 py-1 bg-white/6 rounded text-sm",children:"Reset"})]})]})}function C(){let[e,t]=(0,n.useState)(!1),[i,r]=(0,n.useState)(.5);return(0,n.useEffect)(()=>{function e(e){let t=document.activeElement&&document.activeElement.tagName||"";if("INPUT"!==t&&"TEXTAREA"!==t){if("Space"===e.code){let t=m.getDeckInfo("A").isPlaying,i=m.getDeckInfo("B").isPlaying;t||i?(m.pauseDeck("A"),m.pauseDeck("B")):(m.playDeck("A"),m.playDeck("B")),e.preventDefault()}else if("1"===e.key)m.getDeckInfo("A").isPlaying?m.pauseDeck("A"):m.playDeck("A");else if("2"===e.key)m.getDeckInfo("B").isPlaying?m.pauseDeck("B"):m.playDeck("B");else if("ArrowLeft"===e.key){let e=Math.max(0,i-.05);r(e),m.setCrossfade(e)}else if("ArrowRight"===e.key){let e=Math.min(1,i+.05);r(e),m.setCrossfade(e)}}}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[i]),(0,s.jsxs)("div",{className:"px-4 sm:px-6 md:px-8 py-6 max-w-7xl mx-auto",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.22em] text-gray-400",children:"Live Gesture Deck"}),(0,s.jsx)("h1",{className:"text-3xl font-semibold leading-tight",children:"GestureDJ"})]}),(0,s.jsxs)("div",{className:"space-x-3 flex items-center",children:[(0,s.jsx)(a.E.button,{whileTap:{scale:.96},onClick:function(){t(!0),m.getOrCreateContext()},className:"bg-gradient-to-r from-purple-500 via-pink-500 to-orange-400 px-4 py-2 rounded-lg text-white shadow-lg glow-ring",children:"Start DJ Mode"}),(0,s.jsx)("div",{className:"ml-2",children:(0,s.jsx)(k,{})})]})]}),(0,s.jsxs)("section",{className:"grid gap-5 md:grid-cols-[1fr,minmax(320px,420px),1fr] items-start",children:[(0,s.jsx)("div",{className:"col-span-1",children:(0,s.jsx)(f,{id:"A"})}),(0,s.jsx)("div",{className:"col-span-1 flex flex-col items-center gap-4",children:(0,s.jsx)(x,{value:i,onChange:function(e){r(e),m.setCrossfade(e)}})}),(0,s.jsx)("div",{className:"col-span-1",children:(0,s.jsx)(f,{id:"B"})})]}),(0,s.jsx)("div",{className:"mt-8 flex justify-center",children:(0,s.jsx)(w,{})}),(0,s.jsx)("footer",{className:"mt-10 text-sm text-gray-400 text-center",children:"Camera and audio permissions will be requested when entering DJ Mode."})]})}}},function(e){e.O(0,[287,971,117,744],function(){return e(e.s=9418)}),_N_E=e.O()}]);